<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OCR com OCR.Space API</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f6f8; color: #333; }
    h1 { margin-bottom: 10px; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    video, canvas { width: 100%; border-radius: 8px; background: #000; margin-bottom: 10px; }
    textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-top: 10px; resize: vertical; }
    button { padding: 10px 15px; border: none; border-radius: 8px; background: #007bff; color: white; cursor: pointer; margin: 5px 0; }
    button:disabled { background: #aaa; }
    .btn-secondary { background: #6c757d; }
  </style>
</head>
<body>
  <div class="container">
    <h1>OCR com OCR.Space API</h1>
    <p>Capture uma imagem ou carregue um arquivo e extraia texto usando a OCR.Space API.</p>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none"></canvas>
    <button id="startBtn">Ativar Câmera</button>
    <button id="snapBtn" class="btn-secondary">Capturar Foto</button>
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <button id="uploadBtn" class="btn-secondary">Carregar Imagem</button>
    <button id="ocrBtn">Executar OCR</button>
    <textarea id="result" placeholder="O texto extraído aparecerá aqui..."></textarea>
  </div>

  <script>
    const API_KEY = 'K81214316388957'; // Sua chave API OCR.Space
    const API_URL = 'https://api.ocr.space/parse/image';

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const startBtn = document.getElementById('startBtn');
    const snapBtn = document.getElementById('snapBtn');
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('fileInput');
    const ocrBtn = document.getElementById('ocrBtn');
    const result = document.getElementById('result');

    let lastImageBlob = null;

    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        video.srcObject = stream;
      } catch (err) {
        alert('Erro ao acessar a câmera: ' + err.message);
      }
    };

    snapBtn.onclick = () => {
      const w = video.videoWidth;
      const h = video.videoHeight;
      canvas.width = w;
      canvas.height = h;
      canvas.getContext('2d').drawImage(video, 0, 0, w, h);
      canvas.toBlob(blob => { lastImageBlob = blob; });
    };

    uploadBtn.onclick = () => fileInput.click();

    fileInput.onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const img = new Image();
      img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        canvas.getContext('2d').drawImage(img, 0, 0);
        canvas.toBlob(blob => { lastImageBlob = blob; });
      };
      img.src = URL.createObjectURL(file);
    };

    ocrBtn.onclick = async () => {
      if (!lastImageBlob) return alert('Capture ou carregue uma imagem primeiro.');
      result.value = 'Processando...';
      const formData = new FormData();
      formData.append('apikey', API_KEY);
      formData.append('language', 'por');
      formData.append('isOverlayRequired', false);
      formData.append('file', lastImageBlob, 'image.jpg');

      try {
        const response = await fetch(API_URL, { method: 'POST', body: formData });
        const data = await response.json();
        if (data.ParsedResults && data.ParsedResults.length > 0) {
          result.value = data.ParsedResults[0].ParsedText.trim() || 'Nenhum texto encontrado';
        } else {
          result.value = 'Falha ao reconhecer texto';
        }
      } catch (error) {
        result.value = 'Erro: ' + error.message;
      }
    };
  </script>
</body>
</html>
